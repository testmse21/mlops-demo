<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cat Detector</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #22c55e;
      --accent-2: #ef4444;
      --btn: #2563eb;
      --btn-hover: #1d4ed8;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; min-height: 100vh; display: grid; place-items: center;
      background: radial-gradient(1200px 600px at 70% 10%, #0b1220 0%, var(--bg) 45%);
      color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .card {
      width: min(720px, 92vw); background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(6px);
      padding: 24px; border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    h1 { margin: 0 0 8px; font-weight: 700; letter-spacing: 0.2px; }
    p.sub { margin: 0 0 20px; color: var(--muted); }

    .picker { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .file-input {
      position: relative; display: inline-flex; align-items: center; gap: 8px;
      padding: 10px 14px; border-radius: 12px; border: 1px dashed rgba(255,255,255,0.25);
      cursor: pointer; color: var(--muted); user-select: none;
    }
    .file-input:hover { border-color: rgba(255,255,255,0.4); }
    .file-input input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
    .filename { font-size: 14px; color: var(--text); }

    button {
      appearance: none; border: 0; border-radius: 12px; padding: 12px 16px; font-weight: 600;
      background: var(--btn); color: white; cursor: pointer; transition: transform .02s ease, background .2s ease, opacity .2s ease;
    }
    button:hover { background: var(--btn-hover); }
    button:disabled { opacity: .5; cursor: not-allowed; }

    .preview {
      margin-top: 16px; display: flex; gap: 16px; align-items: center; flex-wrap: wrap;
    }
    .thumb { width: 120px; height: 120px; border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); display: grid; place-items: center; background: #0b1220; }
    .thumb img { width: 100%; height: 100%; object-fit: cover; }
    .status { min-height: 48px; display: flex; align-items: center; gap: 10px; font-size: 16px; color: var(--muted); }

    .result {
      margin-top: 18px; display: none; align-items: center; gap: 12px; padding: 14px 16px; border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.08);
    }
    .result.ok { display: flex; background: rgba(34,197,94,0.08); border-color: rgba(34,197,94,0.25); }
    .result.bad { display: flex; background: rgba(239,68,68,0.08); border-color: rgba(239,68,68,0.25); }
    .label { font-weight: 700; letter-spacing: .2px; }

    .spinner {
      width: 18px; height: 18px; border: 3px solid rgba(255,255,255,0.22); border-top-color: white; border-radius: 50%;
      animation: spin 1s linear infinite; display: none;
    }
    .spinner.show { display: inline-block; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .icons { display: none; align-items: center; gap: 12px; }
    .icons svg { width: 40px; height: 40px; }
    .icons.show { display: inline-flex; }
  </style>
</head>
<body>
  <main class="card">
    <h1>Cat Detector</h1>
    <p class="sub">Upload an image and click <b>Check</b>. The backend is your FastAPI <code>/predict</code> endpoint.</p>

    <div class="picker">
      <label class="file-input" id="fileLabel">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M12 16V4m0 0l-3.5 3.5M12 4l3.5 3.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M5 14v4a2 2 0 002 2h10a2 2 0 002-2v-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
        <span>Choose image</span>
        <input id="file" type="file" accept="image/*" />
      </label>
      <span class="filename" id="filename">No file chosen</span>
      <button id="checkBtn" disabled>Check</button>
      <span class="spinner" id="spinner" aria-live="polite" aria-label="Loading"></span>
    </div>

    <div class="preview" id="preview" hidden>
      <div class="thumb"><img id="thumbImg" alt="Preview" /></div>
      <div class="status" id="status">Ready to check…</div>
    </div>

    <!-- Result banners -->
    <div class="result ok" id="resOk" role="status" aria-live="polite">
      <div class="icons show" aria-hidden="true">
        <!-- Cat icon -->
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
          <path d="M16 22c-2-8 1-12 1-12s6 2 10 6c3-1 7-1 10 0 4-4 10-6 10-6s3 4 1 12c4 3 7 8 7 14 0 12-12 22-28 22S4 48 4 36c0-6 3-11 7-14z" fill="#22c55e"/>
          <circle cx="24" cy="32" r="3" fill="#0b1220"/>
          <circle cx="40" cy="32" r="3" fill="#0b1220"/>
          <path d="M24 42c4 2 12 2 16 0" stroke="#0b1220" stroke-width="3" stroke-linecap="round"/>
        </svg>
      </div>
      <div>
        <div class="label">Cat detected</div>
        <div>Prediction: <code>Cat</code></div>
      </div>
    </div>

    <div class="result bad" id="resBad" role="status" aria-live="polite">
      <div class="icons show" aria-hidden="true">
        <!-- Crossed-out cat icon -->
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <clipPath id="catShape">
              <path d="M16 22c-2-8 1-12 1-12s6 2 10 6c3-1 7-1 10 0 4-4 10-6 10-6s3 4 1 12c4 3 7 8 7 14 0 12-12 22-28 22S4 48 4 36c0-6 3-11 7-14z" />
            </clipPath>
          </defs>
          <g clip-path="url(#catShape)">
            <rect x="0" y="0" width="64" height="64" fill="#9ca3af"/>
          </g>
          <circle cx="32" cy="32" r="30" fill="none" stroke="#ef4444" stroke-width="6"/>
          <path d="M14 50L50 14" stroke="#ef4444" stroke-width="6" stroke-linecap="round"/>
        </svg>
      </div>
      <div>
        <div class="label">Not a cat</div>
        <div>Prediction: <code>Not Cat</code></div>
      </div>
    </div>
  </main>

  <script>
    // === CONFIG ===
    // If your frontend is on a different origin than FastAPI, set API_BASE to that origin.
    // Example: const API_BASE = "http://localhost:8000";
    const API_BASE = ""; // same-origin by default

    const fileInput = document.getElementById('file');
    const fileLabel = document.getElementById('fileLabel');
    const filenameEl = document.getElementById('filename');
    const checkBtn = document.getElementById('checkBtn');
    const spinner = document.getElementById('spinner');
    const preview = document.getElementById('preview');
    const thumbImg = document.getElementById('thumbImg');
    const statusEl = document.getElementById('status');
    const resOk = document.getElementById('resOk');
    const resBad = document.getElementById('resBad');

    function resetResults() {
      resOk.style.display = 'none';
      resBad.style.display = 'none';
      resOk.classList.remove('ok');
      resBad.classList.remove('bad');
    }

    fileInput.addEventListener('change', () => {
      resetResults();
      const file = fileInput.files?.[0];
      if (!file) {
        filenameEl.textContent = 'No file chosen';
        checkBtn.disabled = true;
        preview.hidden = true;
        return;
      }
      filenameEl.textContent = file.name;
      checkBtn.disabled = false;
      // preview image
      const url = URL.createObjectURL(file);
      thumbImg.src = url;
      preview.hidden = false;
      statusEl.textContent = 'Ready to check…';
    });

    checkBtn.addEventListener('click', async () => {
      const file = fileInput.files?.[0];
      if (!file) return;
      resetResults();
      spinner.classList.add('show');
      statusEl.textContent = 'Checking…';
      checkBtn.disabled = true;

      try {
        const form = new FormData();
        form.append('file', file, file.name);
        const resp = await fetch(`${API_BASE}/predict`, { method: 'POST', body: form });
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const data = await resp.json();
        const isCat = String(data.prediction).toLowerCase().includes('cat') && !String(data.prediction).toLowerCase().includes('not');

        if (isCat) {
          resOk.style.display = 'flex';
          resOk.classList.add('ok');
          resBad.style.display = 'none';
          statusEl.textContent = 'Looks like a cat!';
        } else {
          resBad.style.display = 'flex';
          resBad.classList.add('bad');
          resOk.style.display = 'none';
          statusEl.textContent = 'Hmm… not a cat.';
        }
      } catch (err) {
        console.error(err);
        alert('Failed to check image. See console for details.');
        statusEl.textContent = 'Error — try again.';
      } finally {
        spinner.classList.remove('show');
        checkBtn.disabled = !fileInput.files?.[0];
      }
    });
  </script>
</body>
</html>
