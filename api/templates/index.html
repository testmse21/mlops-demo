<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cat Detector</title>
  <style>
    :root{
      --bg:#ffffff; --bg2:#f8fafc; --text:#0f172a; --muted:#64748b;
      --ok:#16a34a; --bad:#dc2626; --line:#e5e7eb; --btn:#2563eb; --btnh:#1d4ed8;
      --ring:rgba(37,99,235,.18); --shadow:0 8px 24px rgba(2,6,23,.06), 0 2px 6px rgba(2,6,23,.04);
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial}
    body{margin:0;background:radial-gradient(1200px 900px at 70% -10%, var(--bg2), var(--bg));color:var(--text)}
    .wrap{min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:28px}
    h1{margin:0 0 6px;font-size:30px;letter-spacing:.2px}
    p{margin:0 0 22px;color:var(--muted);font-size:15px;text-align:center}

    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:center;width:min(760px,94vw)}
    .filebox{flex:1;display:flex;align-items:center;gap:10px;background:#fff;border:1px solid var(--line);padding:12px 18px;height:56px;border-radius:999px;box-shadow:var(--shadow);cursor:pointer;transition:border-color .15s, box-shadow .15s}
    .filebox:focus-within{outline:0;border-color:#c7d2fe;box-shadow:0 0 0 6px var(--ring)}
    .filebox svg{width:22px;height:22px;flex:0 0 auto;color:#64748b}
    .filebox .filename{color:#0f172a;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;opacity:.9}
    #file{display:none}

    button{display:inline-flex;align-items:center;gap:10px;border:0;border-radius:999px;padding:12px 20px;background:linear-gradient(180deg,var(--btn),#1f58e9);color:#fff;font-weight:600;cursor:pointer;box-shadow:var(--shadow);transition:transform .05s ease, filter .15s ease}
    button:hover{filter:brightness(1.03)}
    button:active{transform:translateY(1px)}
    button:disabled{opacity:.6;cursor:not-allowed}
    button svg{width:18px;height:18px}
    .spinner{width:16px;height:16px;border:2px solid rgba(255,255,255,.4);border-top-color:#fff;border-radius:50%;display:none;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .preview{margin-top:16px;display:none;flex-direction:column;align-items:center;gap:10px}
    .thumb{width:220px;height:220px;border-radius:14px;border:1px solid var(--line);overflow:hidden;box-shadow:var(--shadow);background:#fff}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .status{color:var(--muted);font-size:14px}

    .result{margin-top:16px;display:none;align-items:center;gap:12px;padding:12px 14px;border-radius:999px;border:1px solid var(--line);background:#fff;box-shadow:var(--shadow)}
    .result.ok{border-color:rgba(22,163,74,.25);background:rgba(16,185,129,.08)}
    .result.bad{border-color:rgba(220,38,38,.25);background:rgba(248,113,113,.08)}
    .icon img,.icon svg{width:48px;height:48px;object-fit:contain}
    .chip{font-weight:700;letter-spacing:.2px}
  </style>
</head>
<body>
  <main class="wrap">
    <h1>Cat Detector</h1>
    <p>Choose an image and press <b>Check</b>. We'll tell you if it's a cat.</p>
    <div class="row">
      <label class="filebox" id="filebox" tabindex="0">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M4 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Z" stroke="currentColor" stroke-width="1.6"/>
          <path d="M7 16l3.5-3.5L14 16l3-3 2 2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="9" cy="9" r="1.5" fill="currentColor"/>
        </svg>
        <span class="filename" id="filename">Choose an image…</span>
        <input id="file" type="file" accept="image/*" />
      </label>
      <button id="checkBtn" disabled aria-label="Check image">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.8"/>
        </svg>
        <span class="btntext">Check</span>
        <span class="spinner" id="btnSpin"></span>
      </button>
    </div>
    <div class="preview" id="preview">
      <div class="thumb"><img id="thumbImg" alt="Preview" /></div>
      <div class="status" id="status">Ready…</div>
    </div>
    <div class="result ok" id="resOk" role="status" aria-live="polite">
      <div class="icon" aria-hidden="true">
        <img id="catIconOk" alt="Cat icon" />
      </div>
      <div class="chip">It’s a cat!</div>
    </div>
    <div class="result bad" id="resBad" role="status" aria-live="polite">
      <div class="icon" aria-hidden="true" style="position:relative;">
        <img id="catIconBad" alt="Cat icon" style="opacity:0.3;" />
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style="position:absolute;top:0;left:0;width:100%;height:100%;">
          <path d="M14 50L50 14" stroke="var(--bad)" stroke-width="6" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="chip">Not a cat</div>
    </div>
  </main>
  <script>
    // Try common static paths so it works with plain HTML, FastAPI (/ui), or Flask (/static)
    function resolveCatIcon(){
      const candidates = [
        'cat-icon.png',          // same folder as HTML
        '/ui/cat-icon.png',      // FastAPI StaticFiles mounted at /ui
        '/static/cat-icon.png'   // Flask static folder
      ];
      for(const p of candidates){
        const xhr = new XMLHttpRequest();
        xhr.open('HEAD', p, false);
        try{ xhr.send(); if(xhr.status >= 200 && xhr.status < 400){ return p; } }catch{ /* ignore */ }
      }
      return 'cat-icon.png';
    }

    const CAT_ICON_PATH = resolveCatIcon();

    const API_BASE = "";
    const fileInput = document.getElementById('file');
    const filebox = document.getElementById('filebox');
    const filenameEl = document.getElementById('filename');
    const checkBtn = document.getElementById('checkBtn');
    const preview = document.getElementById('preview');
    const thumbImg = document.getElementById('thumbImg');
    const statusEl = document.getElementById('status');
    const resOk = document.getElementById('resOk');
    const resBad = document.getElementById('resBad');
    const btnSpin = document.getElementById('btnSpin');
    const btnText = document.querySelector('#checkBtn .btntext');
    const catIconOk = document.getElementById('catIconOk');
    const catIconBad = document.getElementById('catIconBad');

    // Inject resolved path into both icons
    catIconOk.src = CAT_ICON_PATH;
    catIconBad.src = CAT_ICON_PATH;

    function resetResults(){ resOk.style.display='none'; resBad.style.display='none'; }
    fileInput.addEventListener('change', ()=>{
      resetResults();
      const f = fileInput.files && fileInput.files[0];
      if(!f){
        checkBtn.disabled = true;
        preview.style.display = 'none';
        filenameEl.textContent = 'Choose an image…';
        return;
      }
      filenameEl.textContent = f.name;
      checkBtn.disabled = false;
      thumbImg.src = URL.createObjectURL(f);
      preview.style.display = 'flex';
      statusEl.textContent = 'Ready…';
    });
    filebox.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' || e.key===' '){ e.preventDefault(); fileInput.click(); }
    });
    checkBtn.addEventListener('click', async ()=>{
      const f = fileInput.files && fileInput.files[0];
      if(!f) return;
      resetResults();
      statusEl.textContent='Checking…';
      checkBtn.disabled=true; btnSpin.style.display='inline-block'; btnText.textContent='Checking…';
      try{
        const form = new FormData(); form.append('file', f, f.name);
        const r = await fetch(`${API_BASE}/predict`, { method:'POST', body:form });
        if(!r.ok) throw new Error('HTTP '+r.status);
        const data = await r.json();
        const txt = String(data.prediction||'');
        const isCat = txt.toLowerCase()==='cat' || (txt.toLowerCase().includes('cat') && !txt.toLowerCase().includes('not'));
        if(isCat){ resOk.style.display='flex'; statusEl.textContent='Cat'; }
        else{ resBad.style.display='flex'; statusEl.textContent='Not Cat'; }
      }catch(e){ console.error(e); statusEl.textContent='Error — try again.'; alert('Failed to check image.'); }
      finally{
        btnSpin.style.display='none'; btnText.textContent='Check';
        checkBtn.disabled = !(fileInput.files && fileInput.files[0]);
      }
    });
  </script>
</body>
</html>
